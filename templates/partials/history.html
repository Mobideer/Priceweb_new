<h2>Price History: <span class="mono">{{ sku }}</span></h2>

<form class="toolbar" method="get" onsubmit="event.preventDefault(); showHistory('{{ sku }}', this.days.value)">
    <input type="hidden" name="sku" value="{{ sku }}">
    <label>Days:</label>
    <select name="days" onchange="showHistory('{{ sku }}', this.value)">
        <option value="7" {% if days==7 %}selected{% endif %}>7 Days</option>
        <option value="30" {% if days==30 %}selected{% endif %}>30 Days</option>
        <option value="90" {% if days==90 %}selected{% endif %}>90 Days</option>
    </select>
</form>

<div class="chart-container"
    style="background: var(--header-bg); padding: 15px; border-radius: 6px; border: 1px solid var(--border-color); margin-top: 20px;">
    <canvas id="historyChart-{{ sku }}"></canvas>
</div>

<table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
    <thead>
        <tr>
            <th style="text-align: left; padding: 10px; border-bottom: 1px solid var(--border-color);">Date</th>
            <th style="text-align: left; padding: 10px; border-bottom: 1px solid var(--border-color);">Наша цена</th>
            <th style="text-align: left; padding: 10px; border-bottom: 1px solid var(--border-color);">Мин. цена</th>
            <th style="text-align: left; padding: 10px; border-bottom: 1px solid var(--border-color);">Поставщик</th>
        </tr>
    </thead>
    <tbody>
        {% for item in items %}
        <tr>
            <td style="padding: 10px; border-bottom: 1px solid var(--border-color);">{{ item.day_date }}</td>
            <td style="padding: 10px; border-bottom: 1px solid var(--border-color);">{{ item.our_price }}</td>
            <td style="padding: 10px; border-bottom: 1px solid var(--border-color);">{{ item.min_sup_price }}</td>
            <td style="padding: 10px; border-bottom: 1px solid var(--border-color); font-size: 0.9em; opacity: 0.8;">{{
                item.min_sup_supplier or '-' }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<script>
    (function () {
        const ctx = document.getElementById('historyChart-{{ sku }}').getContext('2d');
        const data = {
            labels: [{% for i in items %}'{{ i.day_date }}', {% endfor %}],
    datasets: [
        {
            label: 'Наша цена',
            data: [{% for i in items %}{{ i.our_price or 'null' }}, {% endfor %}],
        borderColor: '#58a6ff',
            backgroundColor: 'rgba(88, 166, 255, 0.1)',
                fill: true,
                    tension: 0.3
        },
    {
        label: 'Мин. цена поставщика',
            data: [{% for i in items %} { { i.min_sup_price or 'null' } }, {% endfor %}],
    borderColor: '#d29922',
        backgroundColor: 'rgba(210, 153, 34, 0.1)',
            fill: true,
                tension: 0.3
        }
            ]
        };

    const config = {
        type: 'line',
        data: data,
        options: {
            responsive: true,
            plugins: {
                legend: {
                    labels: { color: '#c9d1d9' }
                }
            },
            scales: {
                y: {
                    ticks: { color: '#8b949e' },
                    grid: { color: '#30363d' }
                },
                x: {
                    ticks: { color: '#8b949e' },
                    grid: { color: '#30363d' }
                }
            }
        }
    };

    new Chart(ctx, config);
    }) ();
</script>