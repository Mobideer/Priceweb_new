<h2>Price History: <span class="mono">{{ sku }}</span></h2>

<form class="toolbar" method="get" onsubmit="event.preventDefault(); showHistory('{{ sku }}', this.days.value)">
    <input type="hidden" name="sku" value="{{ sku }}">
    <label>Days:</label>
    <select name="days" onchange="showHistory('{{ sku }}', this.value)">
        <option value="7" {% if days==7 %}selected{% endif %}>7 Days</option>
        <option value="30" {% if days==30 %}selected{% endif %}>30 Days</option>
        <option value="90" {% if days==90 %}selected{% endif %}>90 Days</option>
    </select>
</form>

<!-- Графики отключены по запросу, используется цветовая кодировка таблицы -->

<table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
    <thead>
        <tr>
            <th style="text-align: left; padding: 10px; border-bottom: 1px solid var(--border-color);">Date</th>
            <th style="text-align: left; padding: 10px; border-bottom: 1px solid var(--border-color);">Наша цена</th>
            <th style="text-align: left; padding: 10px; border-bottom: 1px solid var(--border-color);">Мин. цена</th>
            <th style="text-align: left; padding: 10px; border-bottom: 1px solid var(--border-color);">Поставщик</th>
        </tr>
    </thead>
    <tbody>
        {% for item in items %}
        {% set prev = items[loop.index0 - 1] if loop.index0 > 0 else none %}
        <tr>
            <td style="padding: 10px; border-bottom: 1px solid var(--border-color); opacity: 0.7;">{{ item.day_date }}
            </td>
            <td
                style="padding: 10px; border-bottom: 1px solid var(--border-color); font-weight: 500;
                color: {% if prev and prev.our_price and item.our_price < prev.our_price %}var(--success-color){% elif prev and prev.our_price and item.our_price > prev.our_price %}var(--danger-color){% endif %};">
                {{ item.our_price }} ₽
                {% if prev and prev.our_price and item.our_price < prev.our_price %} <small>↓</small>{% elif prev and
                    prev.our_price and item.our_price > prev.our_price %} <small>↑</small>{% endif %}
            </td>
            <td
                style="padding: 10px; border-bottom: 1px solid var(--border-color); font-weight: 500;
                color: {% if prev and prev.min_sup_price and item.min_sup_price < prev.min_sup_price %}var(--success-color){% elif prev and prev.min_sup_price and item.min_sup_price > prev.min_sup_price %}var(--danger-color){% endif %};">
                {{ item.min_sup_price }} ₽
                {% if prev and prev.min_sup_price and item.min_sup_price < prev.min_sup_price %} <small>↓</small>{% elif
                    prev and prev.min_sup_price and item.min_sup_price > prev.min_sup_price %} <small>↑</small>{% endif
                    %}
            </td>
            <td style="padding: 10px; border-bottom: 1px solid var(--border-color); font-size: 0.9em; opacity: 0.8;">
                {{ item.min_sup_supplier or '-' }}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>